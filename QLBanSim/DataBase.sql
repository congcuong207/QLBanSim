USE master
GO
DROP DATABASE QLBANSIM_DAOHIEN
GO
CREATE DATABASE QLBANSIM_DAOHIEN
GO
USE QLBANSIM_DAOHIEN
GO
CREATE TABLE NHAMANG (
	MANM VARCHAR(10) PRIMARY KEY,
	TENNM NVARCHAR(50), 
	GHICHU NVARCHAR(50),
)
GO
CREATE TABLE LOAISIM(
	MALOAI VARCHAR(10) PRIMARY KEY,
	TENLOAI NVARCHAR(50),
	GHICHU NVARCHAR(50),
)
GO
CREATE TABLE SIM(
	MASIM VARCHAR(10)PRIMARY KEY,
	MALOAI VARCHAR(10) FOREIGN KEY(MALOAI) REFERENCES  LOAISIM (MALOAI),
	MANM VARCHAR(10) FOREIGN KEY(MANM) REFERENCES  NHAMANG (MANM),
	SDT CHAR(10),
	GIA INT CHECK (GIA >= 0),
)	
GO
CREATE TABLE NHANVIEN(
	MANV CHAR(10) PRIMARY KEY, 
	HOTEN NVARCHAR(50) NOT NULL, 
	NAMSINH NVARCHAR(20),
	GIOITINH NVARCHAR(3) CHECK (GIOITINH='NAM' OR GIOITINH=N'NỮ'),
	DIACHI NVARCHAR(50) NOT NULL,	
)
GO
CREATE TABLE KHACHHANG
	(
		MAKH CHAR(10) PRIMARY KEY, --Khóa Chính
		MASIM VARCHAR(10) FOREIGN KEY(MASIM) REFERENCES  SIM (MASIM),
		TENKH NVARCHAR(50) NOT NULL,
		DIACHI NVARCHAR(30) NOT NULL,
		SDT CHAR(10) ,
	)
GO
	

CREATE TABLE DONHANG
	(
		MADONHANG CHAR(10) PRIMARY KEY, 
		MAKH CHAR(10) FOREIGN KEY(MAKH) REFERENCES  KHACHHANG(MAKH) ON DELETE CASCADE ON UPDATE CASCADE,
		MANV CHAR(10) FOREIGN KEY(MANV) REFERENCES  NHANVIEN(MANV) ON DELETE CASCADE ON UPDATE CASCADE,
		NGAYMUA varchar(20),	
		
	)
GO
CREATE TABLE CTIET_DONHANG
	(
		MADONHANG CHAR(10) NOT NULL FOREIGN KEY(MADONHANG) REFERENCES  DONHANG(MADONHANG) ON DELETE CASCADE ON UPDATE CASCADE,
		MASIM VARCHAR(10) NOT NULL, FOREIGN KEY(MASIM) REFERENCES  SIM(MASIM) ON DELETE CASCADE ON UPDATE CASCADE,
		PRIMARY KEY(MADONHANG,MASIM)
	)
GO

--NHẬP BẢNG
--NHÀ MẠNG
	INSERT INTO NHAMANG( MANM, TENNM, GHICHU)
	VALUES('VT', 'VIETTEL', '')
	INSERT INTO NHAMANG( MANM, TENNM, GHICHU)
	VALUES('MOBI', 'MOBIFONE', '')
	INSERT INTO NHAMANG( MANM, TENNM, GHICHU)
	VALUES('VINA', 'VINAPHONE', '')
	INSERT INTO NHAMANG( MANM, TENNM, GHICHU)
	VALUES('VNMOBI', 'VIETNAMMOBI', '')
	SELECT *FROM NHAMANG
GO


--LOẠI SIM
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)VALUES('L01', N'TAM HOA', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L02', N'TỨ QUÝ', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L03', N'NGŨ QUÝ', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L04', N'LỤC QUÝ', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L05', N'TAXI', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L06', N'LỘC PHÁT', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L07', N'THẦN TÀI', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L08', N'< 500 NGHÌN', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L09', N'500 - 1 TRIỆU', '')
	INSERT INTO LOAISIM( MALOAI, TENLOAI, GHICHU)
	VALUES('L10', N'> 1 TRIỆU', '')
	SELECT *FROM LOAISIM
GO


--SIM 

	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)VALUES('VT01', 'L02', 'VT', '0345679999',1500000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VT02', 'L03', 'VT', '0976599999',1700000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VT03', 'L04', 'VT', '0919555555',2800000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('MOBI01', 'L01', 'MOBI', '0775431222',600000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VINA01', 'L05', 'VINA', '0825989998',5000000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VINA02', 'L05', 'VINA', '0824797779',4000000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VNMOBI01', 'L03', 'VNMOBI', '0925444421',700000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VNMOBI02', 'L04', 'VNMOBI', '0345678911',1700000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('VT04', 'L04', 'VT', '0944000000',4000000)
	INSERT INTO SIM( MASIM, MALOAI, MANM,SDT,GIA)
	VALUES('MOBI02', 'L04', 'VT', '0933444444',1600000)
	SELECT *FROM SIM
GO
--KHÁCH HÀNG
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)VALUES('KH01','VT02', N'BÙI BẢO TRANG', N'HÀ NỘI','0123456789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH02','VT01', N'NGUYỄN THỊ HẢI YẾN', N'HÒA BÌNH','0123456788')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH03','VT03', N'CẤN THỊ BÍCH NGỌC', N'HÀ NỘI','0123456787')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH04','MOBI01', N'CẤN THỊ TUYẾT MAI', N'HƯNG YÊN','0123496789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH05','VINA01', N'CẤN XUÂN TIẾN', N'HÀ NỘI','0183456789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH06','VINA02', N'ĐÕ AN PHÚ', N'HẢI DƯƠNG','0123457789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH07', 'VNMOBI01', N'ĐÀO THỊ HÀ', N'HÀ NỘI','0167456789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH08', 'VNMOBI02', N'ĐÀO VĂN HOẠT', N'PHÚ THỌ','0123459989')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH09', 'VT04', N'ĐÀO THỊ HIÊN', N'HÀ NỘI','0126856789')
	INSERT INTO KHACHHANG( MAKH, MASIM, TENKH,DIACHI,SDT)
	VALUES('KH10', 'MOBI02', N'ĐỖ THANH TÔN', N'NGHỆ AN','0123456789')
	SELECT *FROM KHACHHANG
GO
--NHÂN VIÊN
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV001',N'VŨ QUANG CƯỜNG', '2002-10-9', N'NAM',N'HẢI DƯƠNG')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV002',N'NGUYỄN HOÀNG LONG', '2002-11-7', N'NAM',N'YÊN MỸ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV003',N'TRẦN THỊ NGỌC LƯƠNG', '2002-7-9', N'NỮ',N'TIÊN LỮ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV004',N'TRẦN THỊ NGỌC', '2002-5-8', N'NỮ',N'TIÊN LỮ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV005',N'TRẦN THỊ NGỌC LINH', '2002-9-3', N'NỮ',N'TIÊN LỮ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV006',N'NGUYỄN MINH KHÔI', '1998-5-8', N'NAM',N'THÀNH CÔNG')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV007',N'ĐỖ NHƯ NGHĨA', '1999-5-8', N'NAM',N'YÊN MỸ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV008',N'TRẦN THỊ NGỌC', '2002-1-8', N'NỮ',N'TIÊN LỮ')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV009',N'ĐÀO ĐÌNH QUYẾT', '2002-9-8', N'NAM',N'THÁI BÌNH')
	INSERT INTO NHANVIEN ( MANV, HOTEN, NAMSINH,GIOITINH,DIACHI)
	VALUES ('NV010',N'CẤN CÔNG CƯỜNG', '1997-7-20', N'NAM',N'HÀ NỘI')
	SELECT *FROM NHANVIEN
GO
--ĐƠN HÀNG
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA) VALUES('DH01', 'KH01', 'NV001','2021-9-3')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH02', 'KH02', 'NV002','2022-10-9')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH03', 'KH03', 'NV003','2022-11-3')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH04', 'KH04', 'NV004','2021-12-4')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH05', 'KH05', 'NV005','2022-9-8')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH06', 'KH06', 'NV006','2021-9-13')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH07', 'KH07', 'NV007','2021-5-3')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH08', 'KH08', 'NV008','2022-8-3')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH09', 'KH09', 'NV009','2021-9-10')
	INSERT INTO DONHANG( MADONHANG, MAKH, MANV,NGAYMUA)
	VALUES('DH10', 'KH10', 'NV010','2021-10-3')
	SELECT *FROM DONHANG
GO
--CHI TIẾT ĐƠN HÀNG	
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH01', 'VNMOBI02')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH02', 'VT04')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH03', 'VNMOBI02')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH04', 'VNMOBI01')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH05', 'VINA02')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH06', 'VINA01')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH07', 'MOBI01')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH08', 'VT03')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH09', 'VT01')
	INSERT INTO CTIET_DONHANG( MADONHANG, MASIM)
	VALUES('DH10', 'VT02')
GO
	SELECT *FROM CTIET_DONHANG

	-----
	SELECT *FROM CTIET_DONHANG
	SELECT *FROM DONHANG
	SELECT *FROM NHANVIEN
	SELECT *FROM KHACHHANG
	SELECT *FROM SIM
	SELECT *FROM LOAISIM
	SELECT *FROM NHAMANG
select DH.*,CTDH.MASIM,S.MANM,S.GIA from CTIET_DONHANG CTDH,DONHANG DH,SIM S WHERE CTDH.MADONHANG=DH.MADONHANG AND CTDH.MASIM=S.MASIM 